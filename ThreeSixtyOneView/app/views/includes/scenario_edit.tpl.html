<div class="scenario-type-dropdown">
    <div class="dropdown">
        <span class="dropdown-toggle">
            {{selectedScenarioElement.cubeMeta.label}} <icon type="caret-down"></icon>
        </span>
        <span ng-hide="selectedScenarioElement.group === 'Marketing Plan'">
            <span class="dropdown-filename"><icon type="file-text-o"></icon> {{selectedScenarioElementsFile}}</span>
            <span ng-click="openScenarioElementFileModal(scenario.id, selectedScenarioElement)" class="filename-option"><icon type="folder-open-o"></icon>Replace</span>
            <span ng-click="openScenarioElementCopyModal(scenario.id, selectedScenarioElement)" class="filename-option"><icon type="folder-open-o"></icon>Copy &amp; Replace</span>
        </span>
        <ul class="dropdown-menu" ms-link-group selected-item="{{selectedScenarioElement.id}}" radio="true">
            <li ng-repeat="scenarioElement in getScenarioElements()" ms-link="{{type.id}}" >
                <a href="" ng-click="setScenarioElement(scenarioElement)">{{scenarioElement.cubeMeta.label}}</a>
            </li>
        </ul>
    </div>
</div>

<div class="editor">
    <tabset>
        <tab id="pivotBuilder" ng-controller="PivotBuilderCtrl">
            <tab-heading>
                <div class="pbTitle" ng-class="{pbTitleSel: !tabClosed, pbGray: tabClosed}">
                    <div class="pbRenameArea">
                        </i><icon type="eye" cname="{{!tabClosed ? '':'pbGray'}}"></icon>
                        <div class="pbTitleText clickable" ng-click="heightChanged(); !tabClosed ? startSaveAs(true) : expandTab()" ng-hide="saveAs">{{viewName}}</div>
                        <div class="pbSaveAsBox" ng-show="saveAs">
                            <input type="text" ng-model="saveAsName" ng-keyup="renameAction($event)">
                            <span class="clickable" ng-click="finishSaveAs(true)"><icon type="check"></icon></span>
                            <span class="clickable" ng-click="finishSaveAs(false)"><icon type="remove"></icon></span>
                        </div>
                    </div>
                </div>
            </tab-heading>
            <div id="pivotBuilder">
                <div ng-class="{hidden: tabClosed, shown: !tabClosed}" class="pbSlider">
                    <div class="pbControlBar">
                        <div class="pbFunctionFlip" ms-link-group  selected-item="table">
                            <div class="pbFunctionFlipButton clickable" ng-click="showTable(false);" ms-link="table"><icon type="table"></icon></div>
                            <div class="pbFunctionFlipButton clickable" ng-click="showTable(true);" ms-link="filters"><icon type="filter"></icon></div>
                        </div>

                        <div class="pbSaveMenu">
                            <div class="dropdown">
                                <span class="pbSaveButton clickable" ng-click="saveView()" >
                                    <icon type="save"></icon>Save View
                                </span>
                                <span class="dropdown-toggle pbSaveDropButton clickable">
                                    <icon type="caret-down"></icon>
                                </span>
                                <ul class="dropdown-menu pbViewSaveMenu" ms-link-group radio="true">
                                    <div class="pbViewSaveMenuVisible">
                                        <li>
                                            <div class="pbViewSaveMenuItem" ng-click="startSaveAs(false);"><icon type="save"></icon>Save As</div>
                                        </li>
                                        <li>
                                            <div class="pbViewSaveMenuItem" ng-click="resetView();"><icon type="undo"></icon>Revert</div>
                                        </li>
                                    </div>
                                </ul>
                            </div>
                        </div>

                        <div class="pbViewsList">
                            <div class="dropdown">
                                <span class="dropdown-toggle pbRecentViewsButton clickable">
                                    <icon type="eye"></icon>Recent Views<icon type="caret-down"></icon>
                                </span>
                                <ul class="dropdown-menu pbRecentViewsMenu" ms-link-group radio="true">
                                    <div class="pbRecentViewsMenuVisible">
                                        <li ng-repeat="view in viewsList">
                                            <div class="" ng-click="loadView(cubeId, view.id);"><icon type="eye"></icon>{{view.name}}</div>
                                        </li>
                                        <hr>
                                        <li>
                                            <div class=""><icon type="folder-open-o"></icon>All Views</div>
                                        </li>
                                    </div>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div id="dragDropArea" ng-hide="filterSection">
                        <div ng-repeat="pivotBuilderItem in pivotBuilderItems" class="pbSec" ng-if="viewData">
                            <div class="pbSecTitle">{{pivotBuilderItem.label}}</div>
                            <div class="pbItemsHolder" data-as-sortable="dragOptions" ng-model="viewData[pivotBuilderItem.name]" tabindex="-1">
                                <draggable-dimension ng-repeat="item in viewData[pivotBuilderItem.name]" row-or-col="{{pivotBuilderItem.name}}"></draggable-dimension>
                                <!-- name="item.level.label" menu="dimensions" -->
                                <add-dimension-btn menu="dimensions" row-or-col="{{pivotBuilderItem.name}}" ng-hide="dragging"></add-dimension-btn>
                            </div>
                        </div>
                    </div>

                    <div class="pbSec" ng-show="filterSection">
                        <div class="pbSecTitle">Filters</div>
                        <div class="pbFilterValues">
                            <div ng-repeat="cat in dimensions" class="pbFilterBox clickable" ng-click="filtersModal(cat)" data-toggle="modal" data-target="#filterModal"  ng-if="addedFilters[cat.label]">
                                <div class="pbFilterCat">{{cat.label}} <span class="pbFilterSize">({{categorizedValue[$index].selected}}/{{categorizedValue[$index].total}})</span></div>
                                <div class="pbFilterVal" ng-show="categorizedValue[$index].selected < categorizedValue[$index].total" data-toggle="tooltip" data-placement="bottom" title="{{categorizedValue[$index].label.join(', ')}}">{{categorizedValue[$index].label.join(', ')}}</div>
                                <div class="pbFilterVal" ng-hide="categorizedValue[$index].selected < categorizedValue[$index].total" title="{{categorizedValue[$index].label.join(', ')}}">All</div>
                            </div>
                        </div>
                    </div>
                    <div class="pbSliderCollapse">
                        <span class="clickable" ng-click="heightChanged(); collapseTab(); finishSaveAs(false);">
                            <icon type="chevron-up"></icon>Collapse
                        </span>
                    </div>
                </div>
            </div>
        </tab>
        <tab ng-controller="importCtrl">
            <tab-heading ng-click="expandTab()">
                Import
            </tab-heading>
        	<div class="importExport" ng-class="{hidden: tabClosed, shown: !tabClosed}">
                <h4>Importing Data</h4>
                <p>Do you want to export a template first? <a href="#">Yes</a></p>
                <div>
                    <div class="fileName" ng-class="{activeFileName: importObj.fileSelected, errFileName: importObj.invalidFile}" onclick="f.click()">{{selectedFile.name}}</div>
                    <button  class="btn activeBtn" ng-class="{inactiveBtn: importObj.fileSelected && !importObj.invalidFile}" onclick="f.click()">Browse</button>
                    <input id="f" type="file" fileread style="display:none;"></input>
                    <div class="errMsg" ng-show="importObj.invalidFile">This file is invalid. Please try again.</div>
                </div>
                <div class="btnGroup">
                    <button class="btn inactiveBtn" ng-show="!importObj.fileSelected || importObj.uploadFinished" ng-click="collapseTab()">Close</button>
                    <button class="btn inactiveBtn" ng-show="importObj.fileSelected && !importObj.uploadFinished" ng-click="initStatus()" ng-disabled="importObj.importClicked">Cancel</button>
                    <button class="btn disabledBtn" ng-hide="importObj.fileSelected && !importObj.invalidFile">Import</button>
                    <button class="btn activeBtn" ng-show="importObj.fileSelected && !importObj.invalidFile" ng-click="uploadFile()" ng-disabled="importObj.importClicked">Import</button>
                </div>
                <div ng-show="importObj.importClicked" class="uploadContainer">
                    <div ng-hide="importObj.uploadFinished">
                        <progressbar value="importObj.uploadProgress"></progressbar>
                        <p class="percentage">{{importObj.uploadProgress}}%</p>
                    </div>
                    <div ng-show="importObj.uploadFinished" class="successMsg">You successfully imported {{selectedFile.name}}</div>
                </div>
                <div class="pbSliderCollapse">
                    <span class="clickable" ng-click="collapseTab()">
                        <icon type="chevron-up"></icon>Collapse
                    </span>
                </div>
            </div>
        </tab>
        <tab ng-controller="exportCtrl">
            <tab-heading ng-click="expandTab()">
                Export
            </tab-heading>
        	<div class="importExport" ng-class="{hidden: tabClosed, shown: !tabClosed}">
                <h4>Exporting Data</h4>
                <p class="warning">The data set you have selected exceeds the 1.4 million row limit on Excel.</p>
                <div ng-hide="exportObj.exportClicked">
                    <div class="pbSec">
                        <div class="pbSecTitle">Dimensions</div>
                        <div class="pbItemsHolder" data-as-sortable="dragOptions" ng-model="viewData" tabindex="-1">
                            <draggable-dimension ng-repeat="item in viewData"></draggable-dimension>
                                        
                            <add-dimension-btn menu="menuList"></add-dimension-btn>
                        </div>
                    </div>
                   <div class="pbSec">
                        <div class="pbSecTitle">Filters</div>
                        <div class="pbFilterValues">
                            <div ng-repeat="cat in dimensions" class="pbFilterBox clickable" ng-click="filtersModal(cat)" data-toggle="modal" data-target="#filterModal"  ng-if="addedFilters[cat.label]">
                                <div class="pbFilterCat">{{cat.label}} <span class="pbFilterSize">({{categorizedValue[$index].selected}}/{{categorizedValue[$index].total}})</span></div>
                                <div class="pbFilterVal" ng-show="categorizedValue[$index].selected < categorizedValue[$index].total" data-toggle="tooltip" data-placement="bottom" title="{{categorizedValue[$index].label.join(', ')}}">{{categorizedValue[$index].label.join(', ')}}</div>
                                <div class="pbFilterVal" ng-hide="categorizedValue[$index].selected < categorizedValue[$index].total" title="{{categorizedValue[$index].label.join(', ')}}">All</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div ng-show="exportObj.exportClicked" class="prepareContainer">
                    <div ng-hide="exportObj.readyForDownload">
                        <p>Preparing files for download</p>
                        <progressbar value="exportObj.prepareProgress"></progressbar>
                        <p class="percentage">{{exportObj.prepareProgress}}%</p>
                    </div>
                    <p ng-show="exportObj.readyForDownload">Your file is ready</p>
                </div>

                <div class="btnGroup">
                    <button class="btn inactiveBtn" ng-hide="exportObj.exportClicked" ng-click="collapseTab()">Cancel</button>
                    <button class="btn inactiveBtn" ng-show="exportObj.exportClicked" ng-click="initStatus()">Cancel</button>
                    <button class="btn activeBtn" ng-click="prepareFile()" ng-hide="exportObj.exportClicked">Export</button>
                    <a href="http://127.0.0.1:9001/views/scenario.tpl.html" download="sample.html" ng-show="exportObj.readyForDownload" class="btn activeBtn">Download</a>
                </div>

                <div class="pbSliderCollapse">
                    <span class="clickable" ng-click="collapseTab()">
                        <icon type="chevron-up"></icon>Collapse
                    </span>
                </div>
            </div>
        </tab>
    </tabset>
    <ng-include src="'views/includes/pivot_table.tpl.html'" ng-controller="pivotTableCtrl" onload="init()"></ng-include>
</div>